{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "range",
      "id": "logo_height_desktop",
      "label": "Logo Height Desktop (px)",
      "min": 20,
      "max": 120,
      "step": 2,
      "default": 48,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "logo_height_mobile",
      "label": "Logo Height Mobile (px)",
      "min": 20,
      "max": 80,
      "step": 2,
      "default": 36,
      "unit": "px"
    },
    {
      "type": "text",
      "id": "logo_text",
      "label": "Logo Text (if no image)",
      "default": "WACAT"
    },
    {
      "type": "text",
      "id": "nav_link_1_text",
      "label": "Nav Link 1 Text",
      "default": "Beneficios"
    },
    {
      "type": "text",
      "id": "nav_link_1_url",
      "label": "Nav Link 1 URL",
      "default": "#beneficios"
    },
    {
      "type": "text",
      "id": "nav_link_2_text",
      "label": "Nav Link 2 Text",
      "default": "Cómo Funciona"
    },
    {
      "type": "text",
      "id": "nav_link_2_url",
      "label": "Nav Link 2 URL",
      "default": "#como-funciona"
    },
    {
      "type": "text",
      "id": "nav_link_3_text",
      "label": "Nav Link 3 Text",
      "default": "Testimonios"
    },
    {
      "type": "text",
      "id": "nav_link_3_url",
      "label": "Nav Link 3 URL",
      "default": "#testimonios"
    },
    {
      "type": "text",
      "id": "nav_link_4_text",
      "label": "Nav Link 4 Text",
      "default": "FAQ"
    },
    {
      "type": "text",
      "id": "nav_link_4_url",
      "label": "Nav Link 4 URL",
      "default": "#faq"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Button Text",
      "default": "Comprar"
    },
    {
      "type": "text",
      "id": "cta_url",
      "label": "CTA Button URL",
      "default": "#producto"
    },
    {
      "type": "text",
      "id": "mobile_cta_text",
      "label": "Mobile CTA Text",
      "default": "Comprar Ahora"
    }
  ]
}
{% endschema %}

<style>
  #header-{{ section.id }} {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 50;
    font-family: Assistant, sans-serif;
    transition: all 0.3s ease;
  }

  #header-{{ section.id }} .header-container {
    max-width: 120rem;
    margin: 0 auto;
    padding: 0 21px;
  }

  @media (min-width: 768px) {
    #header-{{ section.id }} .header-container {
      padding: 0 28px;
    }
  }

  @media (min-width: 1024px) {
    #header-{{ section.id }} .header-container {
      padding: 0 36px;
    }
  }

  #header-{{ section.id }} .header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 80px;
    transition: all 0.3s ease;
  }

  #header-{{ section.id }} .logo-link {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 20px;
    font-weight: 400;
    color: #121212;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  #header-{{ section.id }} .logo-link:hover {
    color: #121212;
  }

  #header-{{ section.id }} .logo-mobile {
    display: block;
    height: {{ section.settings.logo_height_mobile }}px;
    width: auto;
    max-width: 200px;
    object-fit: contain;
  }

  #header-{{ section.id }} .logo-desktop {
    display: none;
    height: {{ section.settings.logo_height_desktop }}px;
    width: auto;
    max-width: 300px;
    object-fit: contain;
  }

  @media (min-width: 640px) {
    #header-{{ section.id }} .logo-mobile {
      display: none;
    }

    #header-{{ section.id }} .logo-desktop {
      display: block;
    }

    #header-{{ section.id }} .logo-link {
      font-size: 24px;
    }
  }

  #header-{{ section.id }} .desktop-nav {
    display: none;
    align-items: center;
    gap: 24px;
  }

  @media (min-width: 1024px) {
    #header-{{ section.id }} .desktop-nav {
      display: flex;
    }
  }

  @media (min-width: 1280px) {
    #header-{{ section.id }} .desktop-nav {
      gap: 32px;
    }
  }

  #header-{{ section.id }} .desktop-nav a {
    font-size: 14px;
    font-weight: 400;
    color: #7C7C7C;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  #header-{{ section.id }} .desktop-nav a:hover {
    color: #121212;
  }

  #header-{{ section.id }} .header-actions {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  #header-{{ section.id }} .cta-button {
    display: none;
    align-items: center;
    gap: 8px;
    background-color: #121212;
    color: #ffffff;
    padding: 10px 20px;
    border-radius: 32px;
    font-size: 14px;
    font-weight: 400;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  #header-{{ section.id }} .cta-button:hover {
    background-color: #000000;
  }

  @media (min-width: 768px) {
    #header-{{ section.id }} .cta-button {
      display: inline-flex;
    }
  }

  #header-{{ section.id }} .mobile-menu-button {
    display: block;
    padding: 8px;
    color: #121212;
    background: none;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  #header-{{ section.id }} .mobile-menu-button:hover {
    background-color: #F3F3F3;
  }

  @media (min-width: 1024px) {
    #header-{{ section.id }} .mobile-menu-button {
      display: none;
    }
  }

  #header-{{ section.id }} .mobile-menu-button svg {
    width: 24px;
    height: 24px;
  }

  #header-{{ section.id }} .mobile-menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    z-index: 40;
    transition: opacity 0.3s ease;
    opacity: 0;
    pointer-events: none;
  }

  @media (min-width: 1024px) {
    #header-{{ section.id }} .mobile-menu-overlay {
      display: none;
    }
  }

  #header-{{ section.id }} .mobile-menu-panel {
    position: fixed;
    right: 0;
    top: 0;
    bottom: 0;
    width: 100%;
    max-width: 384px;
    background-color: #ffffff;
    box-shadow: -4px 0 24px rgba(0, 0, 0, 0.15);
    transform: translateX(100%);
    transition: transform 0.3s ease;
  }

  #header-{{ section.id }} .mobile-menu-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px;
    border-bottom: 1px solid #EDEDED;
  }

  #header-{{ section.id }} .mobile-menu-header span {
    font-size: 18px;
    font-weight: 400;
    color: #121212;
  }

  #header-{{ section.id }} .mobile-menu-close {
    padding: 8px;
    color: #121212;
    background: none;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  #header-{{ section.id }} .mobile-menu-close:hover {
    background-color: #F3F3F3;
  }

  #header-{{ section.id }} .mobile-menu-close svg {
    width: 24px;
    height: 24px;
  }

  #header-{{ section.id }} .mobile-nav {
    padding: 16px;
  }

  #header-{{ section.id }} .mobile-nav a {
    display: block;
    padding: 12px 16px;
    font-size: 16px;
    font-weight: 400;
    color: #121212;
    text-decoration: none;
    border-radius: 12px;
    transition: background-color 0.3s ease;
    margin-bottom: 4px;
  }

  #header-{{ section.id }} .mobile-nav a:hover {
    background-color: #F3F3F3;
  }

  #header-{{ section.id }} .mobile-cta-container {
    padding: 16px;
    border-top: 1px solid #EDEDED;
  }

  #header-{{ section.id }} .mobile-cta-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background-color: #121212;
    color: #ffffff;
    padding: 16px 24px;
    border-radius: 32px;
    font-size: 16px;
    font-weight: 400;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    width: 100%;
  }

  #header-{{ section.id }} .mobile-cta-button:hover {
    background-color: #000000;
  }
</style>

<header id="header-{{ section.id }}" data-header>
  <div class="header-container">
    <div class="header-content" data-header-content>
      <a href="/" class="logo-link">
        {%- if section.settings.logo != blank -%}
          <img
            src="{{ section.settings.logo | img_url: 'master' }}"
            alt="{{ shop.name }}"
            class="logo-mobile"
            loading="eager"
          >
          <img
            src="{{ section.settings.logo | img_url: 'master' }}"
            alt="{{ shop.name }}"
            class="logo-desktop"
            loading="eager"
          >
        {%- else -%}
          <span>{{ section.settings.logo_text }}</span>
        {%- endif -%}
      </a>

      <nav class="desktop-nav">
        <a href="{{ section.settings.nav_link_1_url }}">
          {{ section.settings.nav_link_1_text }}
        </a>
        <a href="{{ section.settings.nav_link_2_url }}">
          {{ section.settings.nav_link_2_text }}
        </a>
        <a href="{{ section.settings.nav_link_3_url }}">
          {{ section.settings.nav_link_3_text }}
        </a>
        <a href="{{ section.settings.nav_link_4_url }}">
          {{ section.settings.nav_link_4_text }}
        </a>
      </nav>

      <div class="header-actions">
        <a href="{{ section.settings.cta_url }}" class="cta-button">
          <i class="las la-shopping-cart"></i>
          {{ section.settings.cta_text }}
        </a>

        <button
          id="mobile-menu-btn-{{ section.id }}"
          class="mobile-menu-button"
          aria-label="Abrir menú"
          aria-expanded="false"
        >
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div
    id="mobile-menu-{{ section.id }}"
    class="mobile-menu-overlay"
    aria-hidden="true"
  >
    <div class="mobile-menu-panel">
      <div class="mobile-menu-header">
        <span>{{ section.settings.logo_text }}</span>
        <button
          id="mobile-menu-close-{{ section.id }}"
          class="mobile-menu-close"
          aria-label="Cerrar menú"
        >
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <nav class="mobile-nav">
        <a href="{{ section.settings.nav_link_1_url }}" class="mobile-menu-link">
          {{ section.settings.nav_link_1_text }}
        </a>
        <a href="{{ section.settings.nav_link_2_url }}" class="mobile-menu-link">
          {{ section.settings.nav_link_2_text }}
        </a>
        <a href="{{ section.settings.nav_link_3_url }}" class="mobile-menu-link">
          {{ section.settings.nav_link_3_text }}
        </a>
        <a href="{{ section.settings.nav_link_4_url }}" class="mobile-menu-link">
          {{ section.settings.nav_link_4_text }}
        </a>
      </nav>

      <div class="mobile-cta-container">
        <a href="{{ section.settings.cta_url }}" class="mobile-cta-button mobile-menu-link">
          <i class="las la-shopping-cart"></i>
          {{ section.settings.mobile_cta_text }}
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  (function() {
    const sectionId = '{{ section.id }}';
    const header = document.querySelector('#header-' + sectionId);
    const headerContent = header.querySelector('[data-header-content]');
    const menuBtn = document.getElementById('mobile-menu-btn-' + sectionId);
    const menuClose = document.getElementById('mobile-menu-close-' + sectionId);
    const mobileMenu = document.getElementById('mobile-menu-' + sectionId);
    const menuLinks = mobileMenu.querySelectorAll('.mobile-menu-link');
    const menuPanel = mobileMenu.querySelector('.mobile-menu-panel');

    let lastScroll = 0;
    let ticking = false;

    function updateHeader() {
      const currentScroll = window.pageYOffset || document.documentElement.scrollTop;

      if (currentScroll > 20) {
        header.style.backdropFilter = 'blur(20px) saturate(180%)';
        header.style.backgroundColor = 'rgba(255, 255, 255, 0.95)';
        header.style.boxShadow = '0 1px 3px 0 rgba(18, 18, 18, 0.08)';
        header.style.borderBottom = '1px solid #EDEDED';

        if (headerContent) {
          headerContent.style.height = '64px';
        }
      } else {
        header.style.backdropFilter = 'blur(8px)';
        header.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
        header.style.boxShadow = 'none';
        header.style.borderBottom = '1px solid rgba(237, 237, 237, 0.5)';

        if (headerContent) {
          headerContent.style.height = '80px';
        }
      }

      lastScroll = currentScroll;
      ticking = false;
    }

    function requestTick() {
      if (!ticking) {
        window.requestAnimationFrame(updateHeader);
        ticking = true;
      }
    }

    window.addEventListener('scroll', requestTick, { passive: true });
    updateHeader();

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function(e) {
        const href = this.getAttribute('href');
        if (href === '#' || href === '') return;

        const target = document.querySelector(href);
        if (!target) return;

        e.preventDefault();

        const headerHeight = header?.offsetHeight || 80;
        const targetPosition = target.getBoundingClientRect().top + window.pageYOffset;
        const offsetPosition = targetPosition - headerHeight - 20;

        window.scrollTo({
          top: offsetPosition,
          behavior: 'smooth'
        });

        if (history.pushState) {
          history.pushState(null, null, href);
        }
      });
    });

    const sections = document.querySelectorAll('section[id]');
    const navLinks = header.querySelectorAll('nav a[href^="#"]');

    const observerOptions = {
      threshold: 0.2,
      rootMargin: '-80px 0px -60% 0px'
    };

    const sectionObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const id = entry.target.getAttribute('id');

          navLinks.forEach(link => {
            const href = link.getAttribute('href');
            if (href === '#' + id) {
              link.style.color = '#121212';
              link.style.fontWeight = '400';
            } else {
              link.style.color = '#7C7C7C';
              link.style.fontWeight = '400';
            }
          });
        }
      });
    }, observerOptions);

    sections.forEach(section => sectionObserver.observe(section));

    function openMenu() {
      mobileMenu.style.opacity = '1';
      mobileMenu.style.pointerEvents = 'auto';
      menuPanel.style.transform = 'translateX(0)';
      menuBtn.setAttribute('aria-expanded', 'true');
      mobileMenu.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';

      menuLinks.forEach((link, index) => {
        link.style.opacity = '0';
        link.style.transform = 'translateX(20px)';
        setTimeout(() => {
          link.style.transition = 'all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)';
          link.style.opacity = '1';
          link.style.transform = 'translateX(0)';
        }, 100 + (index * 50));
      });
    }

    function closeMenu() {
      mobileMenu.style.opacity = '0';
      menuPanel.style.transform = 'translateX(100%)';
      menuBtn.setAttribute('aria-expanded', 'false');
      mobileMenu.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
      setTimeout(() => {
        mobileMenu.style.pointerEvents = 'none';
      }, 300);
    }

    menuBtn?.addEventListener('click', openMenu);
    menuClose?.addEventListener('click', closeMenu);
    mobileMenu?.addEventListener('click', (e) => {
      if (e.target === mobileMenu) closeMenu();
    });

    menuLinks.forEach(link => {
      link.addEventListener('click', () => {
        setTimeout(closeMenu, 150);
      });
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && mobileMenu.style.pointerEvents !== 'none') {
        closeMenu();
      }
    });
  })();
</script>
